/**
 * zoomlens.js v1.0.1
 * Licensed MIT for open source use.
 * Copyright(c)2020-present, Luo Watson.
 * Github: https://github.com/LuoWatson/zoomlens.js, Email: <LuoWatson@yeah.net>
 */
!function(t,e){"use strict";"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self,t.ZoomLens=e())}(this,function(){"use strict";function t(){}function e(){}function i(){}function n(){}function s(t,e,i){var n=Object.prototype.toString.call(t);if("[object Object]"==n)for(var s in t)e.call(i,t[s],s);if("[object Array]"==n)for(var a=0;a<t.length;a++)e.call(i,t[a],a)}function a(t){var e,i={};for(e in t)i[e]=t[e];return i}function o(t,e){var t=t,e=e||1;!function(t,e){setTimeout(t,e)}(t,e)}function h(t,e){var t=t,e=e||1;!function(t,e){var i,n=setInterval(function(){t(n)&&(i=!0,clearInterval(n))},e);o(function(){i||(console.warn(n,":: run suspend!"),clearInterval(n))},3e4)}(t,e)}function r(t,e,i){t.addEventListener?t.addEventListener(e,i):t.attachEvent&&t.attachEvent("on"+e,i)}function d(t,e,i){t.addEventListener?t.removeEventListener(e,i):t.attachEvent&&t.detachEvent("on"+e,i)}function l(t){return/^\[object HTML.+Element\]$/.test(Object.prototype.toString.call(t))?t:"#"==t.charAt(0)?document.getElementById(t.slice(1)):void 0}function f(t){return t>1?1:t<0?0:t}function c(t){return t>1?1:t<0?0:t}function g(t){return t>1?1:t<0?0:t}function m(){return event.pageX?{pageX:event.pageX,pageY:event.pageY}:{pageX:event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,pageY:event.clientY+document.body.scrollTop+document.documentElement.scrollTop}}function u(t,e){t.cursor!=e&&(t.cursor=e)}function p(t,e,i,n){function s(){i(h)}function a(){n(h),d(document,"mousemove",s),d(document,"mouseup",a)}function o(){e(h),r(document,"mousemove",s),r(document,"mouseup",a)}var h={};r(t,"mousedown",o)}function y(){try{!!document.selection&&document.selection.empty(),!!window.getSelection&&window.getSelection().removeAllRanges()}catch(t){}}function v(t,e){e=e?"block":"none",t.display!=e&&(t.display=e)}function w(t,e){t.filter="alpha(opacity="+100*e+")",t.opacity=e}function x(t,e,i){return{tagName:t,props:e,children:i}}var S={mmoc:t,zoom:e,mask:i,pics:n},X={top:0,left:0,margin:0,border:0,padding:0,position:"absolute"},Y={config:{el:null,paths:null,correlate:!0,zoomScale:.38,zoomResize:!1,zoomSeat:"right",picsSeat:"bottom",dotGap:1,dotSize:[1,1],dotColor:"#36c",imgGap:10,picsSpeed:.2,adsorbSpeed:.2,imgBorder:"1px solid #666",zoomType:"normal"},styles:{mmoc:{width:300,height:200,border:"1px solid #222"},zoom:{width:0,height:0},mask:{width:80,height:80},pics:{width:0,height:0}}},z=function(t){if(!(t&&"el"in t&&"paths"in t))throw new Error('Missing the necessary parameters "el" or "paths".');return new z.Fn.Init(t)};return z.Fn=z.prototype,z.Fn.version="v1.0.1",z.Fn.extend=function(t){for(var e in t)this[e]=t[e]},z.Fn.sProto=function(){function t(){}return t.prototype=z.Fn,new t},s(S,function(t,e){t.Fn=t.prototype=z.Fn.sProto(),t.Fn.extend=function(t){for(var e in t)this[e]=t[e]},t.Fn.constructor=t,t.Fn.name=e}),z.Fn.extend({toCss:function(t){var e="",i=/^top$|^left$|^width$|^height$|^padding$|^margin$/;return s(t,function(t,n){i.test(n)&&(t=t.toString(),t="%"!=t[t.length-1]?t+"px":t),e+=n+":"+t+";"}),e},finder:function(t){return this.name?this.great.subsets[t]:this.subsets[t]},setSize:function(t,e){this.getSize(function(t,e,i){i.style.width=t,i.style.height=e})},setAttrs:function(t,e){s(e,function(e,i){switch(i){case"cls":t.className=e;break;case"style":t.style.cssText=this.toCss(e);break;default:t.setAttribute(i,e)}},this)},saveNode:function(t){this.great.element.children.push(t),this.element=t},setImgSize:function(t){this.getImgSize(t,function(t,e,i){i.style.width=t,i.style.height=e})},setImgSeat:function(t){this.getImgSeat(t,function(t,e,i){i.style.top=e,i.style.left=t})},setLocation:function(){this.getLocation(function(t,e,i){i.style.top=e,i.style.left=t})},updateElems:function(t,e){t=t||this.element;var i=document.createElement(t.tagName);this.setAttrs(i,t.props),"children"in t&&s(t.children,function(t){this.updateElems(t,i)},this),e&&e.appendChild(i),t.tag=i},getImgPaths:function(){var t=this.datum.paths;switch(this.name){case"mmoc":case"pics":return"min"in t?t.min:t;case"zoom":return"max"in t?t.max:t}},getLocation:function(t){var e=this.calcLocation(),i=this.element.data={};i.offsetX=e.offsetX,i.offsetY=e.offsetY,t(e.offsetX,e.offsetY,this)},getCurrImgNode:function(){var t=this.finder("pics").element.data.imgChecked||0;return this.finder(this.name).element.children[t]},calcLocation:function(){var t=0,e=0,i=this.name+"Seat",n=this.datum[i],s=this.style.top,a=this.style.left,o=this.finder("mmoc").getData();if(n){switch(n){case"top":e=-this.style.height,s=-s;break;case"left":t=-this.style.width,a=-a;break;case"right":t=o.maxWidth;break;case"bottom":e=o.maxHeight}a=a+o.offsetX+t,s=s+o.offsetY+e}return{offsetX:a,offsetY:s}},upStyles:function(t,e){s(e,function(e,i){this.finder(t).style[i]=e},this)},upSetting:function(t){s(t,function(t,e){this.setting[e]=t},this)},upConfIntoSetting:function(){this.upSetting(Y.config),s(this.subsets,function(t){t.style=a(X)}),s(Y.styles,function(t,e){this.upStyles(e,t)},this)},upUserIntoSetting:function(t){var e={};s(t,function(i,n){"styles"!=n?("el"==n&&(t[n]=l(i)),"zoomScale"==n&&(t[n]=f(i)),"picsSpeed"==n&&(t[n]=c(i)),"adsorbSpeed"==n&&(t[n]=g(i)),e[n]=t[n]):s(t.styles,function(t,e){this.upStyles(e,t)},this)},this),this.upSetting(e)}}),t.Fn.extend({getData:function(){var t=this.style,e=this.getBorder(),i=this.getPadding();return{offsetY:t.top,offsetX:t.left,maxWidth:t.width+2*(e+i),maxHeight:t.height+2*(e+i)}},getBorder:function(){return+(this.style.border+"").match(/\d+/)[0]},getOffset:function(){var t=this.element.tag;return{offsetY:t.offsetTop,offsetX:t.offsetLeft}},getPadding:function(){return this.style.padding},getImgSize:function(t,e){var i=this.style.width,n=this.style.height,s=this.element.children[t],a=new Image;a.src=this.getImgPaths()[t],h(function(){var t=a.width,o=a.height;if(t&&o&&s.tag){var h=i/t;o*h>n&&(h=n/o),t*=h,o*=h;var r=s.data={};return r.width=t,r.height=o,e(t+"px",o+"px",s.tag),!0}})},getImgSeat:function(t,e){var i=this,n=this.getData();h(function(){var s=i.element.children[t];if(s.data&&s.data.width&&s.data.height){var a=(n.maxWidth-s.data.width)/2-i.getBorder(),o=(n.maxHeight-s.data.height)/2-i.getBorder();return s.data.offsetX=a,s.data.offsetY=o,e(a+"px",o+"px",s.tag),!0}})}}),e.Fn.extend({getSize:function(t){var e=this,i=this.element;"inside"==this.datum.zoomType&&h(function(){var n=e.element.tag,s=e.finder("mmoc").getCurrImgNode();if(n&&s.data){var a=s.data.width,o=s.data.height;return i.data.width=a,i.data.height=o,t(a+"px",o+"px",n),!0}})},upImgSeat:function(){this.getCurrImgNode();this.setImgSeat(this.finder("pics").element.data.imgChecked)},upLocation:function(){var t=this,e=this.finder("mmoc");"inside"==this.datum.zoomType&&h(function(){var i=e.getBorder(),n=e.getOffset(),s=t.element.data,a=e.getCurrImgNode();if(s&&a.data){var o=a.data.offsetX+n.offsetX+i,h=a.data.offsetY+n.offsetY+i;return t.element.tag.style.top=h+"px",t.element.tag.style.left=o+"px",s.offsetX=o,s.offsetY=h,!0}})},getImgSize:function(t,e){var i=this,n=this.finder("mask"),s=this.element.children[t],a=this.finder("mmoc").element.children[t];h(function(){if(a.data&&a.data.width&&a.data.height&&s.tag){var t=i.element.data.width||i.style.width,o=i.element.data.height||i.style.height,h=n.element.data.width||n.style.width,r=n.element.data.height||n.style.height,d=t/(h/a.data.width),l=o/(r/a.data.height);s.data={};return s.data.width=d,s.data.height=l,e(d+"px",l+"px",s.tag),!0}})},getImgSeat:function(t,e){function i(){var t=r.data,e=(l.offsetX-t.minEdgeX)/t.width,i=(l.offsetY-t.minEdgeY)/t.height;return{offsetX:-e*d.data.width,offsetY:-i*d.data.height}}function n(){return!!(l&&r.data&&d.data&&l.offsetX&&l.offsetY&&void 0!==r.data.minEdgeX&&void 0!==r.data.minEdgeY)}var s=this,a=this.finder("mmoc"),o=this.finder("mask"),r=a.element.children[t],d=s.element.children[t],l=o.element.data;if(n()){var f=i();d.data.offsetX=f.offsetX,d.data.offsetY=f.offsetY,e(f.offsetX+"px",f.offsetY+"px",d.tag)}else o.getMoveableArea(t),h(function(){if(l=o.element.data,n()){var t=i();return d.data.offsetX=t.offsetX,d.data.offsetY=t.offsetY,e(t.offsetX+"px",t.offsetY+"px",d.tag),!0}})}}),i.Fn.extend({move:function(){var t=this,e=this.finder("zoom"),i=this.element.tag.style,n=e.element.tag.style;v(i,0),v(n,0),r(document,"mousemove",function(){t.isCanMove()?(t.upLocation(),e.upImgSeat(),y(),"inside"!=t.datum.zoomType?(v(i,1),v(n,1)):(v(n,1),u(n,"crosshair")),u(i,"crosshair")):(v(i,0),v(n,0))})},drag:function(){var t=this,e=this.finder("zoom"),i=this.element.tag.style;u(i,"pointer"),p(this.element.tag,function(){t.element.data.lastCoordX=event.offsetX,t.element.data.lastCoordY=event.offsetY,u(i,"move")},function(){t.upLocation(),e.upImgSeat(),y()},function(){u(i,"pointer")})},getSize:function(t){var e=this,i=this.finder("mmoc"),n=this.datum.zoomScale,s=i.getCurrImgNode();h(function(){if(s.data){var i=s.data.width/(10*n),a=s.data.height/(10*n);e.element.data.width=i,e.element.data.height=a,t(i+"px",a+"px",e.element.tag)}return!0})},isCanMove:function(){var t=m(),e=this.finder("pics").element.data.imgChecked,i=this.finder("mmoc").element.children[e];return!!(i.data&&t.pageX>=i.data.minEdgeX&&t.pageY>=i.data.minEdgeY&&t.pageX<=i.data.maxEdgeX&&t.pageY<=i.data.maxEdgeY)},upLocation:function(){var t=m(),e=this.element.data.width,i=this.element.data.height,n=this.finder("mmoc").getCurrImgNode().data;if("drag"==this.datum.zoomType)var s=t.pageX-this.element.data.lastCoordX,a=t.pageY-this.element.data.lastCoordY;else var s=t.pageX-e/2,a=t.pageY-i/2;s=s<n.minEdgeX?n.minEdgeX:s,a=a<n.minEdgeY?n.minEdgeY:a,s=s>n.maxEdgeX-e?n.maxEdgeX-e:s,a=a>n.maxEdgeY-i?n.maxEdgeY-i:a,this.element.data.offsetX=s,this.element.data.offsetY=a,this.setLocation()},getLocation:function(t){var e=this.getCenterAlign();if(this.element.data&&void 0!==this.element.data.offsetX&&void 0!==this.element.data.offsetY)t(this.element.data.offsetX+"px",this.element.data.offsetY+"px",this.element.tag);else{var i=this.element.data;i.offsetX=e.offsetX,i.offsetY=e.offsetY,t(e.offsetX,e.offsetY,this)}},getLoopData:function(){var t=this.datum.dotGap,e=this.datum.dotSize[0],i=this.datum.dotSize[1],n=(this.style.width/(t+e)).toFixed(),s=(this.style.height/(t+e)).toFixed();return{loopX:n,loopY:s,sizeX:e,sizeY:i,stepX:e+(this.style.width-n*e)/(n-1),stepY:i+(this.style.height-s*i)/(s-1)}},getDrawTool:function(){var t=this.element.tag.getContext("2d");return t.canvas.width=this.style.width,t.canvas.height=this.style.height,t.fillStyle=this.datum.dotColor,t},drawingStyle:function(t,e){var i,n,s="",a=this.getLoopData();for(i=0;i<a.loopX;i++)for(n=0;n<a.loopY;n++)if("can"==t)e.fillRect(i*a.stepX,n*a.stepY,a.sizeX,a.sizeY);else{var o=document.createElement("span"),h=o.style;h.cssText=this.toCss(X),h.top=n*a.stepY,h.left=i*a.stepX,h.width=a.sizeX+"px",h.height=a.sizeY+"px",h.background=this.datum.dotColor,h.overflow="hidden",s+=o.outerHTML}"div"==t&&(this.element.tag.innerHTML=s,this.element.tag.appendChild(this.element.children[0].tag))},setCenterAlign:function(){var t=this.getCenterAlign(),e=this.element.tag.style;e.top=t.offsetY+"px",e.left=t.offsetX+"px",this.element.data.offsetX=t.offsetX,this.element.data.offsetY=t.offsetY},getCenterAlign:function(){var t=this.finder("mmoc").getData();return{offsetX:t.offsetX+t.maxWidth/2-this.style.width/2,offsetY:t.offsetY+t.maxHeight/2-this.style.height/2}},getMoveableArea:function(t){var e=this.finder("mmoc"),i=e.element.children[t],n=e.style.top+e.getBorder(),s=e.style.left+e.getBorder();h(function(){if(i.data&&void 0!==i.data.offsetX&&void 0!==i.data.offsetY)return s+=i.data.offsetX,n+=i.data.offsetY,i.data.minEdgeX=s,i.data.minEdgeY=n,i.data.maxEdgeX=s+i.data.width,i.data.maxEdgeY=n+i.data.height,!0})}}),n.Fn.extend({drag:function(){function t(t){/^left$|^right$/.test(n.datum.picsSeat)?t.changer=["top","differentY"]:t.changer=["left","differentX"]}function e(t){var e=t[t.changer[1]],i=parseFloat(s.style[t.changer[0]]);(i>0||i<n.getData().minEdge)&&(t[t.changer[1]]=0,e*=.1),s.style[t.changer[0]]=i+e+"px"}function i(t,e){h(function(){if(e*=.5,s.style[t]=parseFloat(s.style[t])-e.toFixed()+"px",Math.abs(e)<.5)return!0},100*n.datum.adsorbSpeed)}var n=this,s=this.element.children[0].tag,a=this.element.children[1].tag;a.style.cursor="pointer",p(this.element.tag,function(e){a.style.cursor="move";var i=m();e.lastCoordX=i.pageX,e.lastCoordY=i.pageY,t(e)},function(t){var i=m();t.differentX=i.pageX-t.lastCoordX,t.differentY=i.pageY-t.lastCoordY,t.lastCoordX=i.pageX,t.lastCoordY=i.pageY,e(t),y()},function(t){a.style.cursor="pointer",h(function(){t.differentX*=.9,t.differentY*=.9;var a=t.changer;if(Math.abs(t[a[1]])<1.2){var o=n.getData().minEdge,h=parseFloat(s.style[a[0]]);return h<o&&i(a[0],h-o),h>0&&i(a[0],h),!0}e(t)},100*n.datum.picsSpeed)})},hover:function(){var t=this,e=this.finder("zoom"),i=this.finder("mask"),n=e.element.children,s=this.finder("mmoc").element.children;"inside"==e.datum.zoomType&&e.setSize(),e.upLocation(),t.element.data.imgChecked=0,this.imgHover(function(a,o){y(),t.setImgBorder(a,o),t.element.data.imgChecked=a,v(e.element.tag.style,1),s[o].tag.style.display="none",n[o].tag.style.display="none",s[a].tag.style.display="block",n[a].tag.style.display="block","inside"==e.datum.zoomType&&(e.setSize(),i.setSize(),e.upLocation(),e.setImgSize(a)),i.setCenterAlign(),e.upImgSeat()})},getSize:function(t){var e=this.finder("mmoc").getData();/^left$|^right$/.test(this.datum.picsSeat)?t(this.style.width||80,this.style.height||e.maxHeight,this):t(this.style.width||e.maxWidth,this.style.height||80,this)},getData:function(){var t=this.datum.imgGap,e=this.getPicsMinLength(),i=this.element.children[0].children.length,n=i*e+i*t-t;return{minEdge:-((e+t)*i-this.getPicsMaxLength()-t),ulLength:n}},imgHover:function(t){var e=this,i=0;r(this.element.tag,"mousemove",function(){var n=e.getImgElemIndex();~n&&n!=i&&(t(n,i),i=n)})},getImgSize:function(t,e){var i=this.getPicsMinLength();e(i,i,this.element.children[0].children[t].children[0].children[0].props)},getImgSeat:function(t,e){var i=0,n=0,s=this.element.children[0].children[t].children[0].children[0],a=(this.datum.imgGap+this.getPicsMinLength())*t;/^left$|^right$/.test(this.datum.picsSeat)?n=a:i=a,e(i,n,s.props)},setImgBorder:function(t,e){try{var i=this.getPicsMinLength(),n=this.datum.imgBorder,s=this.element.children[0],a=s.children[e].children[0].children[0].tag,o=s.children[t].children[0].children[0].tag;a.style.border=0,o.style.border=n,n=parseFloat(n),a.style.width=i+"px",a.style.height=i+"px",o.style.width=i-2*n+"px",o.style.height=i-2*n+"px"}catch(t){}},getImgElemIndex:function(){var t,e,i;/^left$|^right$/.test(this.datum.picsSeat)?(t="top",e="pageY",i="offsetY"):(t="left",e="pageX",i="offsetX");var n=parseFloat(this.element.children[0].tag.style[t]),s=this.getPicsMinLength(),i=Math.abs(n)+m()[e]-this.element.data[i],a=i/s/((s+this.datum.imgGap)/s),o=parseInt(a);return a>s/(s+this.datum.imgGap)+o&&(o=-1),o},getPicsMinLength:function(){var t=this.style.width,e=this.style.height;return t<e?t:e},getPicsMaxLength:function(){var t=this.style.width,e=this.style.height;return t>e?t:e}}),t.Fn.extend({computeLayout:function(){this.style.overflow="hidden";var t=this.element.children;s(t,function(t,e){this.setImgSize(e),this.setImgSeat(e),t.props.style.display="none"},this),h(function(){if(t[0].tag)return t[0].tag.style.display="block",!0})}}),e.Fn.extend({computeLayout:function(){this.setSize(),this.setLocation(),this.style.overflow="hidden";var t=this.element.children;s(t,function(t,e){this.setImgSize(e),this.setImgSeat(e),t.props.style.display="none"},this),h(function(){if(t[0].tag)return t[0].tag.style.display="block",!0})}}),i.Fn.extend({createElement:function(){var t=this,e="div",i=[];"function"==typeof document.createElement("canvas").getContext?e="canvas":i.push(x(e,{style:a(X)},[])),this.saveNode(x(e,{cls:this.name,style:this.style},i)),"inside"!=t.datum.zoomType&&h(function(){if(t.element.tag)return"canvas"==t.element.tagName?t.drawingStyle("can",t.getDrawTool()):o(function(){t.drawingStyle("div")},20),!0})},computeLayout:function(){this.setLocation();var t=this.element.children[0];t&&(t.props.style.width=this.style.width,t.props.style.height=this.style.height,t.props.style.background="#FFF",w(t.props.style,0)),this.element.data.width=this.style.width,this.element.data.height=this.style.height},triggerEvents:function(){var t=this.finder("zoom");"drag"!=this.datum.zoomType?this.move():this.drag(),"inside"==this.datum.zoomType&&(t.setSize(),this.setSize(),t.upLocation(),t.setImgSize(0))}}),n.Fn.extend({createElement:function(){var t=[],e=[];s(this.getImgPaths(),function(e){t.push(x("li",{style:a(X)},[x("a",{style:a(X)},[x("img",{src:e,style:a(X)},[])])]))}),e.push(x("ul",{style:a(X)},t)),e.push(x("span",{style:a(X)},[])),this.saveNode(x("div",{cls:this.name,style:this.style},e))},computeLayout:function(){this.setSize(),this.setLocation(),this.style.overflow="hidden";var t=this.element.children[0],e=this.element.children[1];t.props.style["list-style"]="none",e.props.style.width=this.style.width,e.props.style.height=this.style.height,e.props.style.background="skyblue",w(e.props.style,0),s(t.children,function(t,e){var i=t.children[0].children[0];i.props.style.display="none",this.setImgSize(e),this.setImgSeat(e),h(function(){if(i.tag)return i.tag.style.display="block",!0})},this)},triggerEvents:function(){this.getData().ulLength>this.getPicsMaxLength()&&this.drag(),this.hover()}}),z.Fn.extend({initEeprom:function(t){this.element=x("div",{cls:"zoom-lens",style:a(X)},[]),s(this.subsets,function(t){t.style={},t.great=this,t.datum=this.setting},this),this.upConfIntoSetting(),this.upUserIntoSetting(t)},createElement:function(){if(this.name){var t=[];s(this.getImgPaths(),function(e){t.push(x("img",{src:e,style:a(X)},[]))}),this.saveNode(x("div",{cls:this.name,style:this.style},t))}s(this.subsets,function(t){t.createElement()})},computeLayout:function(){var t=this.setting,e=t.zoomScale,i=this.subsets.mask.style,n=this.subsets.zoom.style;t.correlate&&(t.zoomResize?(i.width=n.width/(10*e),i.height=n.height/(10*e)):(n.width=i.width*(10*e),n.height=i.height*(10*e))),s(this.subsets,function(t){t.element.data={},t.computeLayout()})},drawingLayout:function(){this.updateElems(),this.setting.el?this.setting.el.appendChild(this.element.tag):this.warn("The specified tag element could not be found!")},triggerEvents:function(){s(this.subsets,function(t){t.triggerEvents()})}}),z.Fn.Init=function(s){this.setting={},this.subsets={mmoc:new t,zoom:new e,mask:new i,pics:new n},this.initEeprom(s),this.createElement(),this.computeLayout(),this.drawingLayout(),this.triggerEvents()},z.Fn.Init.prototype=z.Fn.sProto(),z.Fn.Init.prototype.constructor=z.Fn.Init,z});